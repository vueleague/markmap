var f=Object.defineProperty;var g=(s,t,e)=>t in s?f(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var d=(s,t,e)=>(g(s,typeof t!="symbol"?t+"":t,e),e);import{s as p}from"./toast.ba9d61ec.js";const h=class h{constructor(t,e){d(this,"desc");this.type=t,this.data=e,this.desc=h.descriptions[t]||"Unknown"}asUrl(){switch(this.type){case"gist":const[t,e]=this.data.split(":");return`https://gist.githubusercontent.com/raw/${t}/${e||"markmap.md"}`;case"github":const[o,i]=this.data.split(":"),[r,n]=o.split("@");return`https://raw.githubusercontent.com/${r}/${n||"main"}/${i||"README.md"}`;default:return this.data}}asData(){switch(this.type){case"gist":case"github":return`${this.type}:${this.data}`;default:return this.data}}async load(){const t=this.asUrl(),e=await fetch(t);return b(e),e.text()}static parse(t){if(t instanceof h)return t;let e,o;for(const i of["gist","github"])if(t.startsWith(`${i}:`)){e=i,o=t.slice(i.length+1);break}if(!e){const i=new URL(t);if(i.origin==="https://raw.githubusercontent.com"){const[,r,n,a,...c]=i.pathname.split("/");e="github",o=[`${r}/${n}`,a&&`@${a}`,c.length&&`:${c.join("/")}`].filter(Boolean).join("")}else if(i.origin==="https://gist.githubusercontent.com"||i.origin==="https://gist.github.com"){const{pathname:r}=i;let n,a;r.startsWith("/raw/")?([,,n,...a]=i.pathname.split("/"),a[0]==="raw"&&a.shift()):[,,n,,...a]=i.pathname.split("/"),e="gist",o=[n,a.length&&`${a.join("/")}`].filter(Boolean).join(":")}}return e||(e="url",o=t),new h(e,o)}};d(h,"descriptions",{gist:"GitHub Gist",github:"GitHub Raw",url:"URL"});let l=h;const m=l.parse("gist:af76a4c245b302206b16aec503dbe07b");function w(s){return s.replace(/[<&]/g,t=>({"<":"&lt;","&":"&amp;"})[t])}function b(s){if(!s.ok)throw new TypeError(`Failed to fetch, got response "${s.status} ${s.statusText}"`);return s}function $(s){return l.parse(s).load()}const v=(s=>()=>s++)(0);function x(s){let t;async function e(){const o=v();t=o;const i=new URLSearchParams(window.location.hash.slice(1));let r=i.get("gist");const n=i.get("d");if(r&&!n){r.includes(":")||(r=`gist:${r}`);const u=`#?d=${r}`;await Promise.resolve(),window.location.hash=u;return}let a,c;try{c=await $(n||m)}catch(u){a=u}if(o===t&&(c&&s(c),a))if(a.name==="TypeError"&&/failed to fetch/i.test(a.message))p({title:"Failed to fetch",html:['<div class="mt-1">Please check your network and resource</div>',n&&`<div class="mt-1 text-xs text-gray-600">${w(n)}</div>`].filter(Boolean).join("")});else throw a}return e}function y(s){const t=x(s);return window.addEventListener("hashchange",t),t(),{check:t,dispose:()=>window.removeEventListener("hashchange",t)}}export{l as U,m as d,$ as l,y as s};
